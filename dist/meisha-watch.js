!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.MeishaWatch=e():t.MeishaWatch=e()}(window,function(){function t(t){var e=t.stack.replace(/\n/gi,"").split(/\bat\b/).slice(0,9).join("@").replace(/\?[^:]+/gi,""),o=t.toString();return e.indexOf(o)<0&&(e=o+"@"+e),e}function e(t){var e="";for(var o in t)t.hasOwnProperty(o)&&(e+="&"+o+"="+t[o]);return e.slice(1)}function o(t,e){return("Number"!==e||!Number.isNaN(t))&&toString.call(t).replace(/.*\s(.*)]$/,"$1")===e}function n(t,e){var o=new WeakMap;return function t(n,i){var r,s;return void 0!==e&&(n=e(n)),"object"!=typeof n||null===n||n instanceof Boolean||n instanceof Date||n instanceof Number||n instanceof RegExp||n instanceof String?n:void 0!==(r=o.get(n))?{$ref:r}:(o.set(n,i),Array.isArray(n)?s=n.map(function(e,o){return t(e,i+"["+o+"]")}):(s={},Object.keys(n).forEach(function(e){s[e]=t(n[e],i+"["+e+"]")})),s)}(t,"$")}var i={wechat:!!navigator.userAgent.toLowerCase().match(/MicroMessenger/i),iOS:!!navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),Android:!!navigator.userAgent.match(/Android/i),dev:/127.0.0.1|192.168|localhost/.test(window.location.host)};return new(function(){function r(){this.settings={isReport:!0,reportURL:"",projectId:"",partitionId:""},this.__logs=[],this.user="",this.uniqueId="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}),this.timer=null,this.reportTimes=0,i.iOS?(Object.defineProperty(this,"logs",{value:[],configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(this,"logs",{get:function(){return this.__logs},set:function(t){this.__logs=t,t.length&&this.checkLogs()}})):this.logs=[],this.agentConsole(),this.agentAJAX(),this.configSender(),this.configListener()}return r.prototype.init=function(t){this.settings=t},r.prototype.agentConsole=function(){var t=this;["log","info","warn","debug","error"].forEach(function(e){var o=console[e];console[e]=function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];i.length&&"[MeishaWatch Console]"!==i[0]&&(t.logs=t.logs.concat([{msg:i.map(function(t){return"object"==typeof t?JSON.stringify(n(t,void 0)):t}).join(","),url:window.location.href,type:e}])),o.apply(console,i)}})},r.prototype.agentAJAX=function(){var t=this,e=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(){var o=this,n=[].slice.call(arguments),i=n[0],r=n[1],s=o.onreadystatechange||function(){};return o.onreadystatechange=function(){return 4===o.readyState&&o.status>=400&&(t.logs=t.logs.concat([{msg:i+" "+r+" "+o.status,url:window.location.href,type:"error"}])),s.apply(o,arguments)},e.apply(o,n)}},r.prototype.configListener=function(){var e=this;window.onerror=function(o,n,i,r,s){var a=o;s&&s.stack&&(a=t(s)),e.logs=e.logs.concat([{msg:a.substr(0,500),url:window.location.href,type:"error",line:i,col:r}])}},r.prototype.configSender=function(){var t=this;if(i.iOS&&window.addEventListener("load",function(){t.report(!0)},!1),window.addEventListener("unload",function(){t.report(!1)},!1),i.wechat&&i.Android){var e="hidden";e in document?document.addEventListener("visibilitychange",function(){document[e]&&t.report(!1)},!1):(e="webkitHidden")in document&&document.addEventListener("webkitvisibilitychange",function(){document[e]&&t.report(!1)},!1)}},r.prototype.setUser=function(t){this.user=t},r.prototype.report=function(t){if(void 0===t&&(t=!0),this.settings){var i=this.settings,r=i.reportURL,s=i.projectId,a=i.partitionId,c=i.isReport;if((void 0===c||c)&&this.reportTimes<20&&r&&s&&a){var u=window.performance,p={loadPage:-1,domReady:-1,loadRes:-1};if(u){var d=u.timing;p.loadPage=d.loadEventEnd-d.navigationStart,p.domReady=d.domComplete-d.responseEnd,p.loadRes=d.responseEnd-d.requestStart}var l=o(this.user,"Number")||o(this.user,"String")?this.user:JSON.stringify(this.user),f=JSON.stringify(n(this.logs.slice(),void 0));this.logs=[];try{!function(t,o,n,i,r,s){void 0===i&&(i=!0);var a=new XMLHttpRequest;a.onreadystatechange=function(){4===a.readyState&&(200===a.status?r:s)(JSON.parse(a.responseText))},a.open(o,"GET"===o.toUpperCase()?t+"?"+e(n):t,i),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.send(e(n))}(r,"POST",{projectId:s,partitionId:a,logs:f,times:JSON.stringify(p),user:l,uniqueId:this.uniqueId},t,function(){},function(){})}catch(t){}finally{this.reportTimes++}}}},r.prototype.useVue=function(){var e=this;return{install:function(o){var n=o.version&&o.version.split(".")||[];+n[0]>=2&&+n[1]>=2&&(o.config.errorHandler=function(o,n,r){i.dev&&console.error("[MeishaWatch Console]",o);var s=o?o.stack?t(o):o:"";r&&(s="[Info: "+r+"]->"+s),n&&n.$options&&n.$options.name&&(s="[Component Name: "+n.$options.name+"]->"+s),e.logs=e.logs.concat([{msg:s,url:window.location.href,type:"error"}])}),function(t){var e=window.location.search.substr(1).match(new RegExp("(^|&)"+t+"=([^&]*)(&|$)","i"));return e?decodeURI(e[2]):""}("devtools")&&(o.config.devtools=!0)}}},r.prototype.checkLogs=function(){clearTimeout(this.timer),this.logs.length>=10?this.report():this.timer=setTimeout(this.report,3e3)},r}())});