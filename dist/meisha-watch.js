!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.MeiShaWatch=t():e.MeiShaWatch=t()}(window,function(){function e(e){var t=e.stack.replace(/\n/gi,"").split(/\bat\b/).slice(0,9).join("@").replace(/\?[^:]+/gi,""),o=e.toString();return t.indexOf(o)<0&&(t=o+"@"+t),t}function t(e){var t="";for(var o in e)e.hasOwnProperty(o)&&(t+="&"+o+"="+e[o]);return t.slice(1)}var o={wechat:!!navigator.userAgent.toLowerCase().match(/MicroMessenger/i),dev:/127.0.0.1|192.168|localhost/.test(window.location.host)};return new(function(){function n(){this.user="",this.logs=[],this.agentConsole(),this.agentAJAX(),this.configSender(),this.configListener()}return n.prototype.init=function(e){this.settings=e},n.prototype.agentConsole=function(){var e=this;["log","info","warn","debug","error"].forEach(function(t){var o=console[t];console[t]=function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];n.length&&"[MeiShaWatch Console]"!==n[0]&&e.logs.push({msg:n.map(function(e){return JSON.stringify(e)}).join(","),url:window.location.href,type:t}),o.apply(console,n)}})},n.prototype.agentAJAX=function(){var e=this,t=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(){var o=this,n=[].slice.call(arguments),r=n[0],i=n[1],s=o.onreadystatechange||function(){};return o.onreadystatechange=function(){return 4===o.readyState&&o.status>=400&&e.logs.push({msg:r+" "+i+" "+o.status,url:window.location.href,type:"error"}),s.apply(o,arguments)},t.apply(o,n)}},n.prototype.configListener=function(){var t=this;window.onerror=function(o,n,r,i,s){var a=o;s&&s.stack&&(a=e(s)),t.logs.push({msg:a.substr(0,500),url:window.location.href,type:"error",line:r,col:i})}},n.prototype.configSender=function(){var e=this;window.onunload=function(){e.report()}},n.prototype.setUser=function(e){this.user=e},n.prototype.report=function(){var e=this.settings,o=e.reportURL,n=e.projectName,r=e.moduleName,i=e.isReport;if((void 0===i||i)&&o&&n){var s=window.performance,a={loadPage:-1,domReady:-1,loadRes:-1};if(s){var c=s.timing;a.loadPage=c.loadEventEnd-c.navigationStart,a.domReady=c.domComplete-c.responseEnd,a.loadRes=c.responseEnd-c.requestStart}!function(e,o,n,r,i){var s=new XMLHttpRequest;s.onreadystatechange=function(){4===s.readyState&&(200===s.status?r:i)(JSON.parse(s.responseText))},s.open(o,"GET"===o.toUpperCase()?e+"?"+t(n):e,!0),s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),s.send(t(n))}(o,"POST",{projectName:n,moduleName:r||"",logs:JSON.stringify(this.logs),times:JSON.stringify(a),ua:window.navigator.userAgent,user:JSON.stringify(this.user),uniqueId:"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})},function(){},function(){})}},n.prototype.useVue=function(){var t=this;return{install:function(n){var r=n.version&&n.version.split(".")||[];+r[0]>=2&&+r[1]>=2&&(n.config.errorHandler=function(n,r,i){if(o.dev)console.error("[MeiShaWatch Console]:",n);else{var s=n?n.stack?e(n):n:"";i&&(s="[Info: "+i+"]->"+s),r&&r.$options&&r.$options.name&&(s="[Component Name: "+r.$options.name+"]->"+s),t.logs.push({msg:s,url:window.location.href,type:"error"})}}),function(e){var t=window.location.search.substr(1).match(new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"));return t?decodeURI(t[2]):""}("devtools")&&(n.config.devtools=!0)}}},n}())});